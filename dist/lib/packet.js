import assign from 'lodash/assign';
import extend from 'lodash/extend';
import { packet } from '../packets/packets';
import { ServiceErrorBuilder } from './error';
import { ER_CLIENT_MESSAGE_PROCESS } from '../errors/clientErrors';
import { ER_PACKET_UNKNOWN } from '../errors/packetErrors';
/** Masks for packet description in packet header */
export const ADDRESSABLE_BIT = 0x1000;
export const TAGGED_BIT = 0x2000;
export const ORIGIN_BITS = 0xc000;
export const PROTOCOL_VERSION_BITS = 0xfff;
/** Masks for response types in packet header */
export const RESPONSE_REQUIRED_BIT = 0x1;
export const ACK_REQUIRED_BIT = 0x2;
/** Protocol version mappings */
export const PROTOCOL_VERSION_CURRENT = 1024;
export const PROTOCOL_VERSION_LEGACY = 13312;
/** Packet headers */
export const PACKET_HEADER_SIZE = 36;
export const PACKET_HEADER_SEQUENCE_MAX = 255;
export const PACKET_DEFAULT_SORUCE = '00000000';
/**
 * Packet types used by internal sending process
 */
export var PACKET_TRANSACTION_TYPES;
(function (PACKET_TRANSACTION_TYPES) {
    PACKET_TRANSACTION_TYPES[PACKET_TRANSACTION_TYPES["ONE_WAY"] = 0] = "ONE_WAY";
    PACKET_TRANSACTION_TYPES[PACKET_TRANSACTION_TYPES["REQUEST_RESPONSE"] = 1] = "REQUEST_RESPONSE";
})(PACKET_TRANSACTION_TYPES || (PACKET_TRANSACTION_TYPES = {}));
/**
 * Parses a header buffer object into a Header object
 */
export function headerToObject(buf) {
    let offset = 0;
    /** Frame */
    const size = buf.readUInt16LE(offset);
    offset += 2;
    const frameDescription = buf.readUInt16LE(offset);
    const addressable = (frameDescription & ADDRESSABLE_BIT) !== 0;
    const tagged = (frameDescription & TAGGED_BIT) !== 0;
    const origin = (frameDescription & ORIGIN_BITS) >> 14 !== 0;
    const protocolVersion = frameDescription & PROTOCOL_VERSION_BITS;
    offset += 2;
    const source = buf.toString('hex', offset, offset + 4);
    offset += 4;
    /** Frame Address */
    const target = buf.toString('hex', offset, offset + 6);
    offset += 8;
    let site = buf.toString('utf8', offset, offset + 6);
    site = site.replace(/\0/g, '');
    offset += 6;
    const frameAddressDescription = buf.readUInt8(offset);
    const ackRequired = (frameAddressDescription & ACK_REQUIRED_BIT) !== 0;
    const resRequired = (frameAddressDescription & RESPONSE_REQUIRED_BIT) !== 0;
    offset += 1;
    const sequence = buf.readUInt8(offset);
    offset += 1;
    /** Protocol Header */
    offset += 8;
    const type = buf.readUInt16LE(offset);
    offset += 4;
    return {
        size,
        addressable,
        tagged,
        origin,
        protocolVersion,
        source,
        target,
        site,
        ackRequired,
        resRequired,
        sequence,
        type
    };
}
/**
 * Serializes a header object into a Header buffer
 */
//eslint-disable-next-line complexity
export function headerToBuffer(obj) {
    const buf = Buffer.alloc(PACKET_HEADER_SIZE);
    buf.fill(0);
    let offset = 0;
    /** Frame */
    buf.writeUInt16LE(obj.size, offset);
    offset += 2;
    if (!obj.protocolVersion) {
        if (obj.type === packet.setPowerLegacy.type ||
            obj.type === packet.getPowerLegacy.type ||
            obj.type === packet.statePowerLegacy.type) {
            obj.protocolVersion = PROTOCOL_VERSION_LEGACY;
        }
        else {
            obj.protocolVersion = PROTOCOL_VERSION_CURRENT;
        }
    }
    let frameDescription = obj.protocolVersion;
    if (obj.addressable && obj.addressable === true) {
        frameDescription |= ADDRESSABLE_BIT;
    }
    else if (obj.source && obj.source.length > 0 && obj.source !== PACKET_DEFAULT_SORUCE) {
        frameDescription |= ADDRESSABLE_BIT;
    }
    if (obj.tagged && obj.tagged === true) {
        frameDescription |= TAGGED_BIT;
    }
    if (obj.origin && obj.origin === true) {
        frameDescription |= 1 << 14;
    }
    buf.writeUInt16LE(frameDescription, offset);
    offset += 2;
    if (obj.source && obj.source.length > 0) {
        if (obj.source.length === 8) {
            buf.write(obj.source, offset, 4, 'hex');
        }
        else {
            throw new ServiceErrorBuilder(ER_CLIENT_MESSAGE_PROCESS)
                .withContextualMessage('Light source must be given in 8 characters')
                .build();
        }
    }
    offset += 4;
    /** Frame Address */
    if (obj.target) {
        buf.write(obj.target, offset, 6, 'hex');
    }
    offset += 8;
    if (obj.site) {
        buf.write(obj.site, offset, 6, 'hex');
    }
    offset += 6;
    let frameAddressDescription = 0;
    if (obj.ackRequired && obj.ackRequired === true) {
        frameAddressDescription |= ACK_REQUIRED_BIT;
    }
    if (obj.resRequired && obj.resRequired === true) {
        frameAddressDescription |= RESPONSE_REQUIRED_BIT;
    }
    buf.writeUInt8(frameAddressDescription, offset);
    offset += 1;
    buf.writeUInt8(obj.sequence, offset);
    offset += 1;
    /** Protocol Header */
    offset += 8;
    buf.writeUInt16LE(obj.type, offset);
    return buf;
}
/**
 * Parses a packet buffer into a packet object
 */
export function bufferToObject(buf) {
    try {
        const header = headerToObject(buf);
        const packetBodyHandler = getPacketBodyHandlerByType(header.type);
        if (packetBodyHandler.toObject) {
            const specificObj = packetBodyHandler.toObject(buf.slice(PACKET_HEADER_SIZE));
            return extend(header, specificObj);
        }
        return header;
    }
    catch (err) {
        err.message = `Could not convert buffer to object. Error: ${err.message}`;
        throw err;
    }
}
/**
 * Serializes a packet object into a packet buffer
 */
export function objectToBuffer(obj) {
    const packetHandler = getPacketBodyHandlerByType(obj.type);
    if (packetHandler.toBuffer) {
        const packetTypeData = packet[packetHandler.name].toBuffer(obj);
        return Buffer.concat([headerToBuffer(obj), packetTypeData]);
    }
    return headerToBuffer(obj);
}
/**
 * Creates a packet object
 */
export function createObject(type, params, source, target) {
    const packetHandler = getPacketBodyHandlerByType(type);
    const obj = {};
    obj.type = type;
    obj.size = PACKET_HEADER_SIZE + packetHandler.size;
    if (source) {
        obj.source = source;
    }
    if (target) {
        obj.target = target;
    }
    obj.tagged = packetHandler.tagged;
    return assign(obj, params);
}
export function getPacketBodyHandlerByType(type) {
    for (const packetName in packet) {
        if (packet[packetName].type === type) {
            return packet[packetName];
        }
    }
    throw new ServiceErrorBuilder(ER_PACKET_UNKNOWN).withContextualMessage(`Type: ${type}`).build();
}
export function getPacketBodyHandlerByName(name) {
    for (const packetName in packet) {
        if (packet[packetName].name === name) {
            return packet[packetName];
        }
    }
    throw new ServiceErrorBuilder(ER_PACKET_UNKNOWN).withContextualMessage(`Name: ${name}`).build();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFja2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9wYWNrZXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxNQUFNLE1BQU0sZUFBZSxDQUFDO0FBQ25DLE9BQU8sTUFBTSxNQUFNLGVBQWUsQ0FBQztBQUNuQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDNUMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQzlDLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ25FLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRTNELG9EQUFvRDtBQUNwRCxNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsTUFBTSxDQUFDO0FBQ3RDLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUM7QUFDakMsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQztBQUNsQyxNQUFNLENBQUMsTUFBTSxxQkFBcUIsR0FBRyxLQUFLLENBQUM7QUFFM0MsZ0RBQWdEO0FBQ2hELE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLEdBQUcsQ0FBQztBQUN6QyxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxHQUFHLENBQUM7QUFFcEMsZ0NBQWdDO0FBQ2hDLE1BQU0sQ0FBQyxNQUFNLHdCQUF3QixHQUFHLElBQUksQ0FBQztBQUM3QyxNQUFNLENBQUMsTUFBTSx1QkFBdUIsR0FBRyxLQUFLLENBQUM7QUFFN0MscUJBQXFCO0FBQ3JCLE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztBQUNyQyxNQUFNLENBQUMsTUFBTSwwQkFBMEIsR0FBRyxHQUFHLENBQUM7QUFDOUMsTUFBTSxDQUFDLE1BQU0scUJBQXFCLEdBQUcsVUFBVSxDQUFDO0FBeUpoRDs7R0FFRztBQUNILE1BQU0sQ0FBTixJQUFZLHdC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